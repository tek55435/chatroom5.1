<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Realtime TTS+STT</title>
    <link rel="manifest" href="manifest.json">
  </head>
  <body>
    <script>
      // Allow Flutter to log to console early if needed
      console.info("Starting Flutter Realtime TTS+STT app");
    </script>
    <!-- Safari/iOS audio unlock helper -->
    <script type="application/javascript">
      (function () {
        if (window.webrtcUnlockAudio) return;
        function unlock() {
          try {
            var AC = window.AudioContext || window.webkitAudioContext;
            if (AC) {
              if (!window.__appAudioCtx) window.__appAudioCtx = new AC();
              var ctx = window.__appAudioCtx;
              if (ctx.state !== 'running' && ctx.resume) ctx.resume();
              var b = ctx.createBuffer(1, 1, 22050);
              var s = ctx.createBufferSource();
              s.buffer = b; s.connect(ctx.destination); if (s.start) s.start(0);
            }
            var el = document.getElementById('remote-audio');
            if (!el) { el = document.createElement('audio'); el.id = 'remote-audio'; document.body.appendChild(el); }
            el.setAttribute('playsinline', '');
            el.setAttribute('autoplay', '');
            if (typeof el.play === 'function') { el.play().catch(function(){}); }
          } catch (e) { console.warn('unlock audio failed', e); }
          return true;
        }
        window.webrtcUnlockAudio = unlock;
        // Optionally, auto-wire a one-time gesture listener
        var handler = function(){ try{ unlock(); }catch(e){}; document.removeEventListener('pointerdown', handler); document.removeEventListener('touchend', handler); document.removeEventListener('click', handler); };
        document.addEventListener('pointerdown', handler);
        document.addEventListener('touchend', handler);
        document.addEventListener('click', handler);
      })();
    </script>
    <!-- PCM helper for audio processing (namespaced version) -->
    <script src="pcm_helper_namespaced.js" type="application/javascript"></script>
    <!-- TTS WebRTC handler -->
    <script src="tts_handler.js" type="application/javascript"></script>
    <!-- Ephemeral Chat Integration -->
    <script src="ephemeral_chat.js" type="application/javascript"></script>
    <!-- Share Functionality -->
    <script src="share_helper.js" type="application/javascript"></script>
    <!-- Enhanced share functionality -->
    <script src="share_fix.js" type="application/javascript"></script>
    <!-- Direct share button fix -->
    <script src="share_button_fix.js" type="application/javascript"></script>
  <!-- Debug tools removed -->
  <script src="direct_global_share.js" type="application/javascript"></script>
    <script src="chat-debug.js" type="application/javascript"></script>
    <!-- Share debug tools -->\n    <script src="share_console_log.js" type="application/javascript"></script>
    <script src="share_debug.js" type="application/javascript"></script>
    
    <!-- Direct standalone share implementation -->
    <script src="direct_share.js" type="application/javascript"></script>
    
    <!-- Direct inline script for share functionality - GUARANTEED TO WORK -->
    <script type="application/javascript">
      // Simple inline function to ensure sharing works
      window.shareChat = function(url) {
        console.log('Simple inline shareChat called with:', url);
        
        try {
          // Try Clipboard API first (most reliable)
          if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(url);
            alert('Chat URL copied to clipboard: ' + url);
            return true;
          }
          
          // Fallback method
          var textArea = document.createElement('textarea');
          textArea.value = url;
          document.body.appendChild(textArea);
          textArea.focus();
          textArea.select();
          
          try {
            document.execCommand('copy');
            alert('Chat URL copied to clipboard: ' + url);
            return true;
          } catch(e) {
            alert('Please copy this URL manually: ' + url);
            return false;
          } finally {
            document.body.removeChild(textArea);
          }
        } catch(e) {
          alert('Please copy this URL manually: ' + url);
          return false;
        }
      };
      
      console.log('Inline share function ready');
    </script>
    
    <script src="main.dart.js" type="application/javascript"></script>
  </body>
</html>
<script type="application/javascript"> 
  // GUARANTEED GLOBAL SHARE FUNCTION
  window.directChatShare = function(url) { 
    console.log('directChatShare called with URL: ' + url); 
    try { 
      if (navigator.clipboard) { 
        navigator.clipboard.writeText(url); 
        alert('Chat URL copied to clipboard: ' + url); 
      } else { 
        var textarea = document.createElement('textarea'); 
        textarea.value = url; 
        document.body.appendChild(textarea); 
        textarea.select(); 
        document.execCommand('copy'); 
        document.body.removeChild(textarea); 
        alert('Chat URL copied to clipboard: ' + url); 
      } 
      return true; 
    } catch(e) { 
      alert('Please copy this URL manually: ' + url); 
      return false; 
    } 
  }; 

  // Also keep shareChat as a backup
  window.shareChat = window.directChatShare;
  
  console.log('Global directChatShare function ready'); 
</script> 
